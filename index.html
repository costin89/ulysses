<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLoc</title>
</head>

<body>
<center>
<button onclick="fetchData()">GeoLoc</button>
<button onclick="insertData()">+ In Tabelle einfügen</button>

<table border="1">
    <thead>
        <tr>
            <th>#</th>
            <th>Breitengrad</th>
            <th>Längengrad</th>
            <th>Kompass</th>
        </tr>
    </thead>
    <tbody id="dataOutput">
    </tbody>
</table>
</center>
<script>
    let rowCount = 0;
    let lastLatitude = null;
    let lastLongitude = null;
    let lastAlpha = null;

    function fetchData() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                lastLatitude = position.coords.latitude;
                lastLongitude = position.coords.longitude;
                
                // iOS 13+ Erlaubnis für DeviceOrientation
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission().then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', function(event) {
                                lastAlpha = event.alpha;
                            }, { once: true });
                        }
                    }).catch(console.error);
                } else {
                    // Für nicht-iOS 13+
                    if (window.DeviceOrientationEvent) {
                        window.addEventListener('deviceorientation', function(event) {
                            lastAlpha = event.alpha;
                        }, { once: true });
                    } else {
                        lastAlpha = null;
                    }
                }
            });
        } else {
            alert('Geolocation wird von diesem Browser nicht unterstützt.');
        }
    }

    function insertData() {
        if (lastLatitude !== null && lastLongitude !== null) {
            rowCount++;
            let row = document.createElement('tr');
            row.innerHTML = `<td>${rowCount}</td><td>${lastLatitude.toFixed(6)}</td><td>${lastLongitude.toFixed(6)}</td><td>${lastAlpha ? lastAlpha.toFixed(2) + '°' : 'Nicht unterstützt'}</td>`;
            document.getElementById('dataOutput').appendChild(row);
        } else {
            alert('Bitte zuerst GeoLoc Daten abrufen.');
        }
    }
</script>

</body>

</html>
